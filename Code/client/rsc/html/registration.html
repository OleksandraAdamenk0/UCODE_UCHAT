<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/fonts.css">
    <title>Registration Page</title>
    <link rel="stylesheet" href="../css/unauthorized.css">
</head>
<body>
    <div class="wrapper">
        <div class="container">

            <div class="logo">
                <h1>TAZIK</h1>

                <img src="../img/Logo.png">
            </div>

            <div class="form">
                <h2>Registration</h2>
                
                <form id="form-container">
                    <div class="form-group">
                        <p class="error non-visible"></p>
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <p class="error non-visible"></p>
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" placeholder="Enter password">
                    </div>

                    <div class="form-group">
                        <p class="error non-visible"></p>
                        <label for="contactEmail">Email</label>
                        <input type="text" id="contactEmail" name="contact" placeholder="Enter email">
                    </div>
                    <div class="form-group">
                        <p class="error non-visible"></p>
                        <label for="contactPhone">Phone</label>
                        <input type="text" id="contactPhone" name="contact" placeholder="Enter phone">
                    </div>
                </form>

                <div class="question">
                    <p>
                        Already have an account? <br>
                        <a id="loginBtn">Login</a>
                    </p>
                </div>
            </div>
            <div class="button active" id="signUpButton">Confirm</div>
        </div>
    </div>

    <script>
        const username = document.getElementById('username');
        const password = document.getElementById('password');
        const contactEmail = document.getElementById('contactEmail');
        const contactPhone = document.getElementById('contactPhone');
        const signUpButton = document.getElementById('signUpButton');
        const loginBtn = document.getElementById('loginBtn');

        const emptyUsername = (newText) => {
            const input = document.getElementById("username");

            if (input) {
                const errorElement = input.closest(".form-group")?.querySelector("p.error");

                if (errorElement) {
                    errorElement.textContent = newText;
                    errorElement.classList.remove("non-visible");
                }
            }
        };

        const registeredUsername = (newText) => {
            const input = document.getElementById("username");

            if (input) {
                const errorElement = input.closest(".form-group")?.querySelector("p.error");

                if (errorElement) {
                    errorElement.textContent = newText;
                    errorElement.classList.remove("non-visible");
                }
            }
        };

        const cleanErrors = () => {
            const elements = document.querySelectorAll('.error');

            for (let i = 0; i < elements.length; i++) {
                elements[i].classList.add("non-visible");
            }
        };

        const wrongPasswordFormat = (newText) => {
            const input = document.getElementById("password");
            if (input) {
                const errorElement = input.closest(".form-group")?.querySelector("p.error");
                if (errorElement) {
                    errorElement.innerHTML = newText;
                    errorElement.classList.remove("non-visible");
                }
            }
        };

        const emptyContacts = (newText) => {
            const input1 = document.getElementById("contactEmail");
            const input2 = document.getElementById("contactPhone");

            if (input1 && input2) {
                const errorElement1 = input1.closest(".form-group")?.querySelector("p.error");
                const errorElement2 = input2.closest(".form-group")?.querySelector("p.error");

                if (errorElement1 && errorElement2) {
                    errorElement1.textContent = newText;
                    errorElement1.classList.remove("non-visible");
                    errorElement2.textContent = newText;
                    errorElement2.classList.remove("non-visible");
                }
            }
        };

        const wrongPhoneFormat = (newText) => {
            const input = document.getElementById("contactPhone");
            if (input) {
                const errorElement = input.closest(".form-group")?.querySelector("p.error");
                if (errorElement) {
                    errorElement.textContent = newText;
                    errorElement.classList.remove("non-visible");
                }
            }
        };

        const wrongEmailFormat = (newText) => {
            const input = document.getElementById("contactEmail");
            if (input) {
                const errorElement = input.closest(".form-group")?.querySelector("p.error");
                if (errorElement) {
                    errorElement.textContent = newText;
                    errorElement.classList.remove("non-visible");
                }
            }
        };

        const registeredEmail = (newText) => {
            const input = document.getElementById("contactEmail");
            if (input) {
                const errorElement = input.closest(".form-group")?.querySelector("p.error");
                if (errorElement) {
                    errorElement.textContent = newText;
                    errorElement.classList.remove("non-visible");
                }
            }
        };

        const registeredPhone = (newText) => {
            const input = document.getElementById("contactPhone");
            if (input) {
                const errorElement = input.closest(".form-group")?.querySelector("p.error");
                if (errorElement) {
                    errorElement.textContent = newText;
                    errorElement.classList.remove("non-visible");
                }
            }
        };

        const goToLogin = () => {
            if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.goToLogin) {
                window.webkit.messageHandlers.goToLogin.postMessage(null);
            } else {
                alert('Handler "submitForm" is not registered in WebKit!');
            }
        };

        const sendDataToC = () => {
            const data = {
                action: "register",
                username: username.value.trim(),
                password: password.value.trim(),
                email: contactEmail.value.trim(),
                phone: contactPhone.value.trim(),
            };

            if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.submitRegistrationForm) {
                const jsonData = JSON.stringify(data);
                window.webkit.messageHandlers.submitRegistrationForm.postMessage(jsonData);
            } else {
                alert('Handler "submitForm" is not registered in WebKit!');
            }
        };

        signUpButton.addEventListener('click', () => {
            if (signUpButton.classList.contains('active')) {
                sendDataToC();
            }
        });

        loginBtn.addEventListener('click', () => {
            goToLogin();
        });

        loginBtn.addEventListener('mouseenter', (event) => {
            event.target.style.transition = 'text-shadow 0.5s ease-in-out';
        });

        loginBtn.addEventListener('mouseleave', (event) => {
            event.target.style.transition = 'text-shadow 0.5s ease-in-out, color 0.5s ease-in-out';
        });
    </script>
</body>
</html>
