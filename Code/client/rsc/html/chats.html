<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chats</title>
    <link rel="stylesheet" href="../css/fonts.css">
    <link rel="stylesheet" href="../css/chats.css">
</head>
<body>
    <div class="container-parent">
        <div class="contacts">
            <div class="container-child">
                <div class="contacts-header">
                    <img src="../img/contacts_header_icon.png" height="54px">
                    <div class="contacts-search">
                        <img src="../img/search.png" height="26px">
                        <input type="text" placeholder="Search">
                    </div>
                </div>
                <div class="contacts-between">
                    <h2>Chats</h2>
                    <div class="button-add">
                        <img src="../img/add.png" height="54px">
                    </div>
                </div>
                <div class="contacts-list">
                    <div class="container-child">
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="chat">
            <div class="container-child">
                <div class="chat-header">
                    <img src="../img/unknown_chat.png" height="54px">
                    <h3>Choose chat</h3>
                </div>
                <div class="chat-message-area">
                    
                </div>
                <div class="chat-footer">
                    <input type="text" id="typeMessage" name="typeMessage" placeholder="Type your message here...">
                </div>
            </div>
        </div>
    </div>

    <!-- Popup -->
    <div class="popup" id="popup">
        <div class="popup-content">
            <h3>Add Contact</h3>
            <input type="text" id="newContactName" placeholder="Enter contact name">
            <button id="addContactButton">Add Contact</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const contactsList = document.querySelector('.contacts-list .container-child');
            const chatHeader = document.querySelector('.chat-header');
            const chatArea = document.querySelector('.chat-message-area');
            const messageInput = document.querySelector('.chat-footer input');
            const buttonAdd = document.querySelector('.button-add');
            const popup = document.getElementById('popup');
            const addContactButton = document.getElementById('addContactButton');
            const newContactNameInput = document.getElementById('newContactName');

            popup.style.display = 'none';

            const backendContacts = [
                
            ];

            const chatHistory = {};

            let currentChat = null;

            function renderContacts() {
                contactsList.innerHTML = '';
                backendContacts.forEach(contact => {
                    const contactDiv = document.createElement('div');
                    contactDiv.className = 'contact';
                    contactDiv.innerHTML = `
                        <div class="contact-area">
                            <img src="../img/unknown_chat.png" height="64px">
                            <div>
                                <h3>${contact.name}</h3>
                                <p>${contact.lastMessage}</p>
                            </div>
                        </div>
                    `;
                    contactDiv.addEventListener('click', () => loadChat(contact.name));
                    contactsList.appendChild(contactDiv);
                });
            }

            function loadChat(contactName) {
                document.querySelectorAll('.contact').forEach(contact => {
                    contact.classList.remove('selected');
                });

                const selectedContact = Array.from(contactsList.children).find(contact =>
                    contact.querySelector('h3').innerText === contactName
                );
                if (selectedContact) {
                    selectedContact.classList.add('selected');
                }
                
                chatHeader.innerHTML = `
                    <img src="../img/unknown_chat.png" height="54px">
                    <h3>${contactName}</h3>
                `;
                chatArea.innerHTML = '';
                currentChat = contactName;

                if (chatHistory[contactName]) {
                    chatHistory[contactName].forEach(message => {
                        const messageDiv = document.createElement('div');
                        messageDiv.className = message.from;

                        if (message.from === 'message-from') {
                            messageDiv.innerHTML = `
                                <div class="decoration"></div>
                                <div class="cloud">
                                    <p>${message.text}</p>
                                    <div class="time">${message.time}</div>
                                </div>
                            `;
                        } else {
                            messageDiv.innerHTML = `
                                <div class="cloud">
                                    <p>${message.text}</p>
                                    <div class="time">${message.time}</div>
                                </div>
                                <div class="decoration"></div>
                            `;
                        }
                        chatArea.appendChild(messageDiv);
                    });

                    chatArea.scrollTop = chatArea.scrollHeight;
                }
            }

            buttonAdd.addEventListener('click', () => {
                popup.style.display = 'block';
            });

            addContactButton.addEventListener('click', () => {
                const newContactName = newContactNameInput.value.trim();
                if (newContactName) {
                    backendContacts.push({ name: newContactName, lastMessage: '(no messages yet)', time: '' });
                    chatHistory[newContactName] = [];
                    renderContacts();
                    popup.style.display = 'none';
                    newContactNameInput.value = '';
                }
            });

            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    popup.style.display = 'none';
                }
            });

            messageInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' && messageInput.value.trim() !== '' && currentChat) {
                    const text = messageInput.value.trim();
                    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    if (!chatHistory[currentChat]) {
                        chatHistory[currentChat] = [];
                    }
                    chatHistory[currentChat].push({ from: 'message-to', text, time });

                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message-to';
                    messageDiv.innerHTML = `
                        <div class="cloud">
                            <p>${text}</p>
                            <div class="time">${time}</div>
                        </div>
                        <div class="decoration"></div>
                    `;
                    chatArea.appendChild(messageDiv);

                    chatArea.scrollTop = chatArea.scrollHeight;

                    messageInput.value = '';
                }
            });

            renderContacts();
        });
    </script>
</body>
</html>